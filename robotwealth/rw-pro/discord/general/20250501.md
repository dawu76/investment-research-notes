### 2025 May Discord notes

---

Question for Kris: "Wonder if when you have time you could share your experience on this? It was related to the blogpost that Nx0 shared."

> Never tried it seriously in the time series like in the post, but my professional trading life was mostly low-latency spread trading. It was.... difficult to say the least. Personally, I would never try to do it as a solo trader in tradfi markets. Just too much to manage and so much that can go wrong in a highly competitive arena. It would be more conceivable for indie traders in crypto - but likely getting harder (we did a bit of this back in the FTX days), or possibly in less liquid/mature markets. But it's a full time job.
>
> ... Assuming you weren't click trading it Kris, what was the most operationally intensive part of it? Do you have any stories of things that did go wrong and how you managed them?

Kris: Let's start with the fact that there are different stages of the life cycle of a trading system like the one we were running
- Research and model development
- Execution software development, including compliance with exchange requirements
- Tracking and monitoring - especially fills vs "arrival price" - there are challenges of quoting both legs (one will inevitably run away from you at some point).
- Measuring latency at different points in the system.
- Babysitting live trading and fixing issues on the fly
- Improving and iterating 
- Interpreting results of monitoring 
- Faster execution
- Smarter quoting/hitting algorithm
- Each of those stages has its own problems. And most of those stages overlap with one another in time - they're all happening in parallel, essentially. So even the prioritisation and project management aspects have their own challenges. 

It's hard to say what the biggest issues were. But when I was doing the global futures stuff, the execution challenges were significant. Part of our edge was just providing liquidity to lumpy flow. We were hedging the risk elsewhere. Our hedging algorithm would try to quote that leg as well, which is really difficult to do in practice. We spent a lot of time on that thing. 

When we were doing it in crypto, it was more your traditional latency arbitrage - see a stale quote that's far enough from your model of fair value to be worth your while and try to be the first to hit it. Since we were just hitting quotes, the execution was a lot simpler... we essentially managed it with "fill or kill" type orders. And we didn't bother hedging... just let the variance wash out over time. 

With the crypto stuff, we were also aware that there was a limit to how much we could compete. There would come a time when someone faster or with a better model would simply outcompete us. Figuring out when to pull the pin and when to engage in the arms race was a real challenge that required understanding the opportunity, as well as the opportunity cost of prioritising this over other opportunities.

---

Question: Would be interested to know how many people were interested in HF stuff... my assumption has always been that it would be off limits to most here due to trading part time.

I think one of the most practical things we could do is show you what we did when we were doing this stuff in crypto. Something like a case study on our latency arbitrage trade:
- How we modelled fair value
- How we actually traded the thing
- How we measured and tracked latencies
- The software we used
- Why it stopped working

Question: i feel in H/F stuff, the problem I am worried about is how to handle inventory risk. i mean if the market keeps going one direction ...
- Kris: I'll check how we dealt with this, but from memory, we just had position limits and flattened everything at the end of a session, where a "session" was just someone babysitting the strategy.

---

Question: How do you guys allocate you portfolio cash between strategies? I'm only trading the TLAQ strategies and have just allocated a specific amount of cash to each strategy (their `vol_target` % of all the summed `vol_targets`). But this mean that quite a big part of the portfolio is in cash most of the time, which seems rather suboptimal.
- Euan: For me with TLAQ each strategy adds or subtracts to a master list of netted positions, with the value added or subtracted based on the target volatility and symbol’s recent volatility. That list is then squashed such that the sum of the positions fits into a % of my overall portfolio. That way I avoided having money parked in cash, or since I now use leveraged ETFs, frees up cash for other strategies.
- Kris: If you have a lot of spare cash, your portfolio vol target could be on the low side. There's nothing wrong with that per se, but it sounds like maybe you could stomach more vol. What's your current portfolio vol target?

This is how I have set it up at the moment: R/P is allocated 12 / 18, while window dressing and fund rebalancing get 3 vol units each.

```
risk_premia = {
    RiskpremiaEtfs.BONDS: 4,
    RiskpremiaEtfs.SP500: 5,
    RiskpremiaEtfs.GOLD: 3
}

window_dressing = 3
fund_rebalance = 3
```

So the way I calculate how much of the portfolio every strategy can use is by summing the above targets and the allocating their percentage of the total target. Which means risk premia is basically allocated 66% of my portfolio cash, and the other strats get 16.66% each. So if the vol is low, risk premia can max use 66% of the portfolio. So this is where I'm unsure if this is the correct way to do it, as even if this is fully invested, I will still be 33% in cash across some of each month as the seasonal effects aren't in play. 

Kris: I think I can see what's happening here ... You're treating your cash allocation as if it's derived directly from your vol targets. When you're setting vol targets, it's helpful to think in terms of your portfolio "vol budget" - this is the total amount of vol you want to distribute among the portfolio components. It's analogous to having a capital budget that you distribute proportionally. But it's not the same thing. 

In your case, RPH has a vol target of 12, which is 66% of your portfolio's vol budget ... not 66% of its capital. The actual position sizes that translates to will depend on the volatility of the underlying assets. The general formula for the position size in dollars is: `target_vol/realised_vol * capital`.

Say bond vol is currently at 12 units, stock vol is at 15 and gold vol is at 20. Your position sizes in dollars will be:
- Bonds: 4/12 * portfolio_value (target vol = 4, realized vol = 12)
- Stocks: 5/15 portfolio_value (target vol = 5, realized vol = 15)
- Gold: 3/20 portfolio_value (target vol = 3, realized vol = 20)

Response: It does make sense and also use the formula above. I just thought that I needed som way of contraining the positions wrt to the portfolio value. Of course this can be done on the overall portfolio positions which might minimize the leftover cash a alot.
- My reasoning for doing the cash allocation per strategy was to avoid that some strategies might not get their full exposure.
- Lets say I'm already using almost all of my cash with the Risk Premia allocations as vol is quite low. Then the window dressing effect is "active" and I now need to buy a lot of DTLA (TLT), but due to my current allocation, I can only buy maybe 50% of what the strategy wants. 
- This means that I underweight this strategy compared to Risk Primia wrt to my overall portfolio in low-volatility enviroments and not in high vol environments, whcih might have a negative effect on the overall performance. Not something I have tested, just a thought. Or at least that is what I think. Because I'm just trying to optimize my allocation to the strategies and how they add performance to the portfolio. And I wasn't sure how to do this originally, so went with this, but having following the performance over a few months, it just feels like I am way too much in cash.

Kris: You're talking more about being constrained by your maximum leverage (which is probably 1). 
- The way I deal with this in the TLAQ app (and generally) is to reduce each allocation proportionally to get my actual leverage down to my maximum leverage.
- Say you would need 1.5 * your total capital to hit the position sizes dictated by your vol targets. But your max leverage is 1. Then you would just *reduce all your volatility targets by 33%* so that you're within your leverage constraint, and you've maintained the same proportional volatility targets as intended. You could also tactically reduce certain components more than others if you wanted to - no hard and fast rules.
- Response: So the leverage needed to hit position sizes -- 1.5 in your example -- do you calculate that every day based on an assumption of all strategies taking positions? So basically assuming that you need to trade for all the strategies even though some don’t have signals at the given date?
- Kris: It depends on how hot you're running compared to your buying power. If you're always exceeding your max leverage, you should probably think about changing something operationally (e.g. a portfolio margin account, use of leveraged instruments etc.) or reducing your portfolio volatility. Your leverage is just a *constraint that should be built in to your position sizing calculations*, ideally. (See the YOLO trade helper spreadsheet for example). And yeah the easiest is to just assume that those sparse strategies contribute an "average" volatility rather than trying to model what they actually do. I think we did some stuff on this in the TLAQ lesson called something like _"portfolio construction meets the real world"_. Planning to do much more implementation stuff this year... would an example spreadsheet or R script be useful?
- Another response: We had a sizing sheet a while back that looked like this. The cool thing about it was that you could see the target and realized volatilities of the individual strategies as well as the portfolio equity and volatility. I can't remember which course it was from. However, it was very tedious to add new strategies. An improved version of that sheet would already be quite useful, I think, but I would also appreciate an R implementation.
- Kris: Here's the link to that [sizing spreadsheet](https://docs.google.com/spreadsheets/d/1kYKdOJCmKwu0bt1AMrRaXu5Zcsw8NAQhY32ipqv8VQA/edit?usp=sharing). It's a few years old now. We used it way back when we ran the Zero to Robot Master Bootcamp (a course on automating 2 ETF strategies and an FX strategy with Zorro). You can still update the data and use the spreadsheet for that specific portfolio. But you'll probably find it more useful to use as inspiration for your own sizing calculations. We could also build this out into something more generally useful when we look at implementation stuff later in the year.
- Question: I looked into this, and can see that the rolling vol is annualized with sqrt(365), which for me seems odd as there is not 365 trading days in a year. Isn't it usually 252 that is used in cases like this? ... I checked the R code for the TLAQ shiny App and can see 252 is used in there. Think this is likely due to the stuff just being old and quite outdated I guess.
- I updated my code to fit the proper implementation of the volatility targeting w.r.t. portfolio constraints, and the results was opposite of what I expected. It now wants even lower exposure for the RPH strategy, and I think this actually makes sense, as all strategies are now "considered" equal w.r.t. how the cash is divided. Positions are scaled down with same factor should max leverage be exceeded, whereas before RPH got a bigger part of the cash due to it having a higher summed volatility target (12% vs 3 for the other 2 strategies). In general, I think my confusion w.r.t. to the sizings was just me being oblivious to the high volatility of the assets at the moment. My calculations (which can be wrong) has the following 60-day vol for the traded assets: 'CSPX': 27.28, 'DTLA': 16.88, 'IGLN': 26.21.
- Kris: That all makes sense. I just had a quick look on TradingView and your vols match what I'm seeing. In the spreadsheet, the rolling vol calc should indeed use sqrt(252) - must have been a typo or maybe copied over from a crypto sizing spreadsheet (since crypto trades 365 days a year, you'd use sqrt(365)) ... Spreadsheet updated to use sqrt(252).

---

Question: How do you track your trades, strategies and overall portfolios? Personally I have a database where I save every transaction, strategy signal and portfolio info which I just host locally. Then I am making a simple dashboard to visualize it.
- Kris: I've pretty much gone to just tracking strategy and platform p&l in a spreadsheet. But I've really simplified my trading the last ~18 months. I used to track strategy performance pretty carefully, including stuff that I stopped trading. But now I basically do that via the strategy simulation notebooks in the lab at irregular intervals.
- I added SQLite - containing trades only - to calculate realised & unrealised P&L on the fly, and amend their open quantity contributing to P&L. This is a personal preference, to do this real time, instead of doing it periodically outside of the execution software. But probably the P&L calculation can be done with using a trades CSV file only, or with Excel voodoo.

---

Question: If I wanted to build up foundational understanding of stat arb (concepts + research + impl) , is the stat arb 2022 course the best place to start? or would you suggest the paris trading bootcamp?
- Kris: I actually think this [TLAQ webinar](https://robotwealth.com/courses/trade-like-a-quant-bootcamp/lessons/bonus-material-previous-course-webinars/topic/tlaq-4-qa-webinar-3-and-statistical-arbitrage-feb-2023/) - _"Q&A Webinar 3 and Statistical Arbitrage – Feb 2023"_ - we did in one of the previous TLAQ runs is the best place to start. Also available [here](https://robotwealth.com/courses/trade-like-a-quant/) for some people depending on which TLAQ they did with us.
- Response: Speaking of which, did you ever run the crypto pairs trading in production? it was mentioned in the last two lectures of the 2022 stat arb course.
- Kris: Not really... we did some stat arby type stuff but never got around to broad crypto pairs trading before FTX went kaboom. Kind of lost the appetite for a while after that.
- Response: I'd like to see a summary of things to look at that work for American crypto traders if there are any.  I know in the past it hasn't been a thing ... AFAIK you can’t trade perps?  Could you do lending protocols for stablecoins? ... No idea. At one time the thinking in the RW community was crypto was too regulated in the States to bother with.  Based on that, I've totally ignored it. But maybe it's changed, hence my question. Right now, I'm making over 100%/yr in high yield ETFs with little work so maybe I don't care ... It is NOT illegal to trade perps but it is operationally inconvenient. First you have most DEXs block your US IP address so you have to get past that with VPN. Then the sketchy on-ramps to get fiat into crypto. Then the DEX might surprise you with KYC request and lock your trading privileges. And on top of all this is the general scammy-ness of crypto. So trade small... is it worth it for small gains? I'd have to identify a very large edge to go thru all that.
- RobotJames: Simple dumb data mining of pairs and lead/lag relationships does still seem to work in crypto, at least it looks like it does with what i think costs should look like. never actually done it though.

... What’s the high yield etf trade?
- Response: For example: $MSTY. A number of people on this site will tell you that you can DIY by selling covered calls.  Maybe/Maybe not.  You have to work your own math and factor in your own time to execute.  My time is valuable. Others may tell you that the risk is high. Maybe/Maybe not. I don't know. These investments are typically done on margin.  I am using reasonable margin and have been doing this for about 6 months.  All dividends have been reinvested. I am currently making 109%/year if the dividends continue. They probably won't. But I'm in about 10 ETFs so there is some diversification. Think carefully about your own personal risk tolerance before jumping in.  Over 100% per year sounds great until we find out that we missed a key issue.
- Speaking of replicating high yield etf: [Substack post](https://thetill.substack.com/p/how-to-buy-a-rolex-every-two-years) by Mark Phillips.
